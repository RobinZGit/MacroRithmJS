<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- Настройка viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Подключаем Bootstrap CSS 
    <link rel="stylesheet" href="css/bootstrap.min.css" > -->
	<title>Calendar</title>

    <style>"font-size: 200%" 
    </style>
<script>
/*
1. сетка. массив лет/месяцев/недель/дней/часов... (размерность сетки) от начальной до конечной точки
   -выкидываем из массива часть точек (опр. периоды размерности сетки (пн-пт) и тп.)
   -если нужно выкидываем из остатка точки по ФУНКЦИИ ЧАСТОТЫ. Тогда нужна еще
     СУПЕРРАЗМЕРНОСТЬ. Напр размерность день суперразмерность неделя. Функция частоты от 0 до 1. 
	 Считаем ее значение в начале каждого интервала суперразмерности
	 кол во точек которые надо оставить в интервале равно этой частоте умножить на кол во точек в интервале
	 эти точки раскидываем по интервалу равномерно начиная с заполненной точки и через равные промежутки
   -в результате остается массив действующих точек. По нему считаем выдавать сообщение или нет. 
     По нему же считаем ОБЪЕМ СЕТКИ = ОБЪЕМ ВРЕМЕНИ
   
 2. Величина нагрузки. Размерность величины. Считанм по ФОРМУЛЕ-ПОСЛЕДОВАТЕЛЬНОСТИ НАГРУЗКИ 
*/
var Gl_aCalendar=[
	//===  значения колонок  ====
	["id","name","period_description","period_type","period_formula","button_onclick"],
	//доступ по имени поля а не по индексу такой:  item[ Gl_aDeals[0].indexOf('name') ]
	//!!! нужно делать доступ по имени поля чтобы всегда можно было добавить поля
	["id","наименование дела","описание периодичности","объект с параметрами ритма","'функция выводить либо не выводить в тек. список'==''","функция вызова онлайн ритма, если нужно вывести в виде кнопки"],
	//===========================

	//workout
	[1,"отжимания вниз головой","по понедельникам","{'volume':'100000','units':'раз','type': 'константа','datebeg':'01.01.2019','dateend':'01.01.2022','valuebeg':'10'}","GlDate.getDay()==1"],
	[2,"подтягивания на одной руке", "по вторникам","","GlDate.getDay()==2"],
	[3,"флаг", "по четвергам","","GlDate.getDay()==4"],
	[4,"флаг", "по пятницам","","GlDate.getDay()==5"],
	[5,"спичаги с брусьев на количество", "по субботам","","GlDate.getDay()==6"],
	[6,"спичаги с рук на количество. ходьба на руках.","", "по воскресеньям","GlDate.getDay()==0"],

	//health and imp
	[101,"'не есть до ' + switch (4){case 4: '17';case 6: '18';default: '19';}", "по средам","","GlDate.getDay()==3","alert('100500')"],
    [102,"дых. в обед равномерно увелич по шагам", "","","true",],
    
	//imp
	[100001,"6 мин из 60 стоп", "по выходным","","true",""],
	
	//тест
	//[1000001,"ТЕСТ + switch (4){case 4: '17';case 6: '18';default: '19';}", "всегда","","true","alert('100500')"],

];

//пытаемся вычислить строку как формулу. если не получается оставляем строку как есть
function ev(s) {
	if (!((s.trim()) == ""))
		try
		{return eval(s);} catch(e) {return s;}
	else return "";
}

function resizeAll() {
	// button.style.width = document.body.clientWidth - 20; 
	// GltxtSpeek.style.width = button.style.width;
}

//основная функция. вывод списка текеущих дел
function loadCurrentData() {
	//var GltxtSpeek  = document.getElementById("idTextsToSpeek");
	var button  = document.getElementById("idStartBtn");
	var GlDate = new Date();

	Gl_aCalendar
		.filter(function(item, i, arr) { try
					{ return eval(item[Gl_aCalendar[0].indexOf('period_formula')]) > 0;} catch (e) {return false;};})
		.forEach(
		function(item, i, arr) { 
			//old GltxtSpeek.value += "" + (i+1) + ": " + ev(item[0]) + " - " + ev(item[1]) + "\n"
			// Создаем элемент ДИВ
			var div = document.createElement("div");
			// Добавляем HTML-контент с пом. свойства innerHTML
			div.innerHTML = '<li>' + ev(item[Gl_aCalendar[0].indexOf('name')]) + ' - ' + ev(item[Gl_aCalendar[0].indexOf('period_description')]);// + '</>';
			if (!!item[Gl_aCalendar[0].indexOf('button_onclick')])  
				if (item[Gl_aCalendar[0].indexOf('button_onclick')].trim().length > 0)
					div.innerHTML += '<button ' + ' onclick="' + item[Gl_aCalendar[0].indexOf('button_onclick')] + '">Запустить</>';
			div.innerHTML += '</li><p> </p><p> </p>';
			// Добавляем новый узел в конец списка полей
			document.getElementById("divInit").appendChild(div);

			;});
}  

//калькулятор ритмов
function startCalculator(){
  //document.getElementById("divCalendar").removeChild();
  if (!document.getElementById("divCalendar").hasChildNodes()){
    var sSelectSetkaDimension = '<select><option disabled>Выберите размерность:</option><option value="час">час</option><option selected value="день">день</option><option value="неделя">неделя</option><option value="месяц">месяц</option><option value="год">год</option></select>';
	
    //
    var div = document.createElement("div");
    div.innerHTML = '<div>'  + 'Калькулятор ритма' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	//
	div = document.createElement("div");
    div.innerHTML = '<li>'  + 'Настройка временной сетки' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	//
	div = document.createElement("div");
    div.innerHTML = '<label>'  + 'Размерность сетки' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	//
	div = document.createElement("div");
    div.innerHTML =sSelectSetkaDimension;
	div = document.getElementById("divCalendar").appendChild(div);
	//
	div = document.createElement("div");
    div.innerHTML = '<div>'  + 'Размерность отрезка разбинения (д.б. крупней размерности сетки, например "неделя" для размерности "день")' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	// !сделать пред размерность плюс уровень выше
	div = document.createElement("div");
    div.innerHTML =sSelectSetkaDimension;
	div = document.getElementById("divCalendar").appendChild(div);
    //
	div = document.createElement("div");
    div.innerHTML ='<p>Дата начала периода: <input type="date" name="calendar">';
	div = document.getElementById("divCalendar").appendChild(div);
	//
	div = document.createElement("div");
    div.innerHTML ='<p>Дата окончания периода: <input type="date" name="calendar">';
	div = document.getElementById("divCalendar").appendChild(div);
	
	//
	//
	div = document.createElement("div");
    div.innerHTML = '<li>'  + 'Настройка ритма на сетке' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	//
	// ? не работает скрыть все..
	div = document.createElement("div");
    div.innerHTML = '<button onclick="document.getElementById("divCalendar").deleteData()">'  + 'Скрыть калькулятор' + '\n</>';
    document.getElementById("divCalendar").appendChild(div);
	//
  }
}
</script>


  </head>
  <body onload="loadCurrentData()" onresize = "resizeAll()" style="color: #633366; font-size:250%">
	<h3 class="bg-primary p-a-1">Текущие дела: </h3>
	<div id = "divInit" style="color: #633366; font-size:90%"></div>
	<!--
	<p>
	<textarea id = "idTextsToSpeek" style = "width:600px;height:400px"></textarea>
	</p>
	-->
	<p></p>
	<p></p>
	<p>
	  <button id = "idCalculator" style = "width:200px;height:30px" onclick="startCalculator()" >Калькулятор ритмов</button>
	</p>
	<div id = "divCalendar" style="color: #333366; font-size:100%"></div>
  </body>
</html>
