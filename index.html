<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- Настройка viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Подключаем Bootstrap CSS 
    <link rel="stylesheet" href="css/bootstrap.min.css" > -->
	<title>Calendar</title>


<script>
var Gl_aDeals =[
	//===  значения колонок  ====
	["id","name","period_description","period_type","period_formula","button_onclick"],
	//доступ по имени поля а не по индексу такой:  item[ Gl_aDeals[0].indexOf('name') ]
	//!!! нужно делать доступ по имени поля чтобы всегда можно было добавить поля
	["id","наименование дела","описание периодичности","объект с параметрами ритма","'функция выводить либо не выводить в тек. список'==''","функция вызова онлайн ритма, если нужно вывести в виде кнопки"],
	//===========================

	//workout
	[1,"отжимания вниз головой","по понедельникам","{'volume':'100000','units':'раз','type': 'константа','datebeg':'01.01.2019','dateend':'01.01.2022','valuebeg':'10'}","GlDate.getDay()==1"],
	[2,"подтягивания на одной руке", "по вторникам","","GlDate.getDay()==2"],
	[3,"флаг", "по четвергам","","GlDate.getDay()==4"],
	[4,"флаг", "по пятницам","","GlDate.getDay()==5"],
	[5,"спичаги с брусьев на количество", "по субботам","","GlDate.getDay()==6"],
	[6,"спичаги с рук на количество. ходьба на руках.","", "по воскресеньям","GlDate.getDay()==0"],

	//health and imp
	[101,"'не есть до ' + switch (4){case 4: '17';case 6: '18';default: '19';}", "по средам","","GlDate.getDay()==3","alert('100500')"],
    [102,"дых. в обед равномерно увелич по шагам", "","","true",],
    
	//imp
	[100001,"6 мин из 60 стоп", "по выходным","","true",""],
	
	//тест
	[1000001,"ТЕСТ + switch (4){case 4: '17';case 6: '18';default: '19';}", "всегда","","true","alert('100500')"],

];

//пытаемся вычислить строку как формулу. если не получается оставляем строку как есть
function ev(s) {
	if (!((s.trim()) == ""))
		try
		{return eval(s);} catch(e) {return s;}
	else return "";
}

function resizeAll() {
	// button.style.width = document.body.clientWidth - 20; 
	// GltxtSpeek.style.width = button.style.width;
}

function loadCurrentData() {
	//var GltxtSpeek  = document.getElementById("idTextsToSpeek");
	var button  = document.getElementById("idStartBtn");
	var GlDate = new Date();

	Gl_aDeals
		.filter(function(item, i, arr) { try
					{ return eval(item[Gl_aDeals[0].indexOf('period_formula')]) > 0;} catch (e) {return false;};})
		.forEach(
		function(item, i, arr) { 
			//old GltxtSpeek.value += "" + (i+1) + ": " + ev(item[0]) + " - " + ev(item[1]) + "\n"
			// Создаем элемент ДИВ
			var div = document.createElement("div");
			// Добавляем HTML-контент с пом. свойства innerHTML
			div.innerHTML = '<li>' + ev(item[Gl_aDeals[0].indexOf('name')]) + ' - ' + ev(item[Gl_aDeals[0].indexOf('period_description')]) + '\n</>';
			if (!!item[Gl_aDeals[0].indexOf('button_onclick')])  
				if (item[Gl_aDeals[0].indexOf('button_onclick')].trim().length > 0)
					div.innerHTML += '<button ' + ' onclick="' + item[Gl_aDeals[0].indexOf('button_onclick')] + '">Запустить</>';
			div.innerHTML += '<p> </p><p> </p>';
			// Добавляем новый узел в конец списка полей
			document.getElementById("divInit").appendChild(div);

			;});
}    
</script>


  </head>
  <body onload="loadCurrentData()" onresize = "resizeAll()">
	<h3 class="bg-primary p-a-1">Текущие дела: </h3>
	<div id = "divInit"></div>
	<!--
	<p>
	<textarea id = "idTextsToSpeek" style = "width:600px;height:400px"></textarea>
	</p>
	-->
	<p></p>
	<p></p>
	<p>
	  <button id = "idStartBtn" style = "width:100px;height:30px" onclick="{alert(Gl_aDeals[0][1].trim().length);}" >test feachure</button>
	</p>
  </body>
</html>
